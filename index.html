<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Panel Admin - Chat Global</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
      :root{
        --primary:#00b4d8;
        --primary-dark:#0096c7;
        --accent:#ff006e;
        --danger:#d32f2f;
        --warning:#ffa500;
        --success:#00d084;
        --bg-light:#f0f9ff;
        --bg-white:#ffffff;
        --text-primary:#0a3d62;
        --text-secondary:#5a6c7d;
        --border:#e0e6ed;
      }
      *{box-sizing:border-box}
      html,body{height:100%;margin:0;font-family:Poppins,system-ui,-apple-system,"Segoe UI",sans-serif;background:#f8fbff}
      body{display:flex;flex-direction:column}

      .admin-header{background:linear-gradient(90deg,var(--danger) 0%,#b71c1c 100%);color:white;padding:20px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 4px 12px rgba(0,0,0,0.15)}
      .admin-header h1{margin:0;font-size:1.5rem}
      .admin-header p{margin:0;font-size:0.9rem;opacity:0.9}
      .admin-back-btn{background:rgba(255,255,255,0.2);border:1px solid rgba(255,255,255,0.5);color:white;padding:10px 16px;border-radius:6px;cursor:pointer;font-weight:600;text-decoration:none;transition:all 0.2s}
      .admin-back-btn:hover{background:rgba(255,255,255,0.3)}

      .admin-container{flex:1;width:100%;margin:0;padding:20px 20px 20px 120px;display:flex;flex-direction:column;gap:20px}

      .admin-panel{background:white;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.08);padding:24px;display:flex;flex-direction:column;max-height:calc(100vh - 140px);overflow-y:auto}
      .admin-panel h2{margin:0 0 20px;color:var(--text-primary);font-size:1.3rem;border-bottom:2px solid var(--border);padding-bottom:12px}

      .admin-controls{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap}
      .admin-controls input{flex:1;min-width:150px;padding:10px;border:1px solid var(--border);border-radius:6px;font-family:inherit}
      .admin-controls button{padding:10px 16px;background:var(--primary);color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:0.9rem;transition:all 0.2s}
      .admin-controls button:hover{background:var(--primary-dark)}
      .admin-controls button.danger{background:var(--danger)}
      .admin-controls button.danger:hover{background:#b71c1c}
      .admin-controls button.warning{background:var(--warning)}
      .admin-controls button.warning:hover{background:#ff8c00}

      .users-table{width:100%;border-collapse:collapse;font-size:0.9rem}
      .users-table th{background:var(--bg-light);padding:12px;text-align:left;font-weight:600;color:var(--text-primary);border-bottom:2px solid var(--border)}
      .users-table td{padding:12px;border-bottom:1px solid var(--border)}
      .users-table tr:hover{background:var(--bg-light)}
      .users-table tbody{overflow-y:auto;display:block;max-height:none}
      #databaseTable tbody{overflow-y:auto;max-height:600px}

      .user-row{display:flex;align-items:center;gap:12px}
      .user-avatar{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--primary),var(--accent));color:white;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:0.9rem}
      .user-info{flex:1}
      .user-info .name{font-weight:600;color:var(--text-primary)}
      .user-info .details{font-size:0.8rem;color:var(--text-secondary)}

      .action-buttons{display:flex;gap:6px}
      .action-buttons button{padding:6px 10px;font-size:0.75rem;border:none;border-radius:4px;cursor:pointer;transition:all 0.2s;font-family:inherit;font-weight:600}
      .action-buttons .edit-name{background:var(--primary);color:white}
      .action-buttons .edit-name:hover{background:var(--primary-dark)}
      .action-buttons .kick{background:var(--warning);color:white}
      .action-buttons .kick:hover{background:#ff8c00}
      .action-buttons .ban{background:var(--danger);color:white}
      .action-buttons .ban:hover{background:#b71c1c}

      .stats{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px}
      .stat-card{background:var(--bg-light);border-radius:8px;padding:16px;text-align:center}
      .stat-card .value{font-size:2rem;font-weight:700;color:var(--primary)}
      .stat-card .label{font-size:0.9rem;color:var(--text-secondary);margin-top:4px}

      .status-badge{display:inline-block;padding:4px 8px;border-radius:4px;font-size:0.75rem;font-weight:600}
      .status-badge.online{background:rgba(0,208,132,0.2);color:var(--success)}
      .status-badge.banned{background:rgba(211,47,47,0.2);color:var(--danger)}

      .empty-state{padding:40px 20px;text-align:center;color:var(--text-secondary)}
      .empty-state p{margin:0}

      .modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;backdrop-filter:blur(4px);z-index:5000}
      .modal-overlay.active{display:flex}
      .modal-dialog{background:white;padding:32px;border-radius:12px;min-width:400px;box-shadow:0 20px 60px rgba(0,0,0,0.3)}
      .modal-dialog h3{margin:0 0 16px;color:var(--text-primary)}
      .modal-dialog input{width:100%;padding:12px;border:1px solid var(--border);border-radius:6px;margin-bottom:16px;font-family:inherit}
      .modal-dialog input:focus{outline:none;border-color:var(--primary)}
      .modal-buttons{display:flex;gap:12px;justify-content:flex-end}
      .modal-buttons button{padding:10px 16px;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-family:inherit;transition:all 0.2s}
      .modal-buttons .cancel{background:var(--border);color:var(--text-primary)}
      .modal-buttons .cancel:hover{background:#ccc}
      .modal-buttons .confirm{background:var(--primary);color:white}
      .modal-buttons .confirm:hover{background:var(--primary-dark)}

      .toast{position:fixed;bottom:20px;right:20px;padding:16px 24px;background:white;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15);display:none;z-index:6000;animation:slideIn 0.3s ease}
      .toast.show{display:block}
      .toast.success{border-left:4px solid var(--success)}
      .toast.error{border-left:4px solid var(--danger)}
      .toast.warning{border-left:4px solid var(--warning)}
      @keyframes slideIn{from{transform:translateX(400px);opacity:0}to{transform:translateX(0);opacity:1}}

      .sidebar{position:fixed;left:0;top:96px;width:80px;height:calc(100vh - 96px);background:linear-gradient(180deg,#ff4757 0%,#ff3f34 100%);padding:20px;box-sizing:border-box;color:white;overflow:hidden;border-radius:0 8px 8px 0;border-right:3px solid rgba(0,0,0,0.1);transition:width 0.4s cubic-bezier(0.4,0,0.2,1);z-index:199}
      .sidebar:hover{width:280px}
      .sidebar-menu{list-style:none;margin:0;padding:0}
      .sidebar-item{position:relative;margin-bottom:12px}
      .sidebar-link{display:flex;align-items:center;gap:15px;padding:14px 16px;color:white;text-decoration:none;border-radius:8px;transition:all 0.3s;font-weight:600;white-space:nowrap;cursor:pointer}
      .sidebar-link:hover{background:rgba(255,255,255,0.15);transform:translateX(4px);box-shadow:0 4px 12px rgba(0,0,0,0.2)}
      .sidebar-link.active{background:rgba(0,0,0,0.2);border-left:4px solid white;padding-left:12px}
      .sidebar-icon{font-size:1.4rem;min-width:24px;display:flex;align-items:center;justify-content:center}
      .sidebar-text{display:none;font-size:0.9rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
      .sidebar:hover .sidebar-text{display:block}
      .sidebar:hover{background:#1a1a1a;width:280px}
      .sidebar:hover .sidebar-link{border-radius:6px}
      .sidebar:hover .sidebar-link:hover{background:rgba(255,255,255,0.1)}
      .sidebar:hover .sidebar-link.active{background:linear-gradient(90deg,rgba(255,71,87,0.8),rgba(255,71,87,0.3));border-left:4px solid #ff4757}

      @media (max-width:768px){
        .sidebar{width:60px}
        .sidebar:hover{width:200px}
      }
      .admin-section{display:none;background:white;border-radius:12px;padding:24px;box-shadow:0 2px 8px rgba(0,0,0,0.08)}
      .admin-section.active{display:block}

      @media (max-width:768px){
        .admin-container{grid-template-columns:1fr}
        .modal-dialog{min-width:90vw}
        .stats{grid-template-columns:1fr}
      }

      #adminLoginOverlay{position:fixed;inset:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;backdrop-filter:blur(4px);z-index:10000}
      #adminLoginOverlay.hidden{display:none}
      .admin-login-box{background:white;padding:48px;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,0.3);text-align:center;max-width:400px}
      .admin-login-box h1{margin:0 0 12px;color:var(--danger);font-size:2rem}
      .admin-login-box p{margin:0 0 32px;color:var(--text-secondary);font-size:0.95rem}
      .admin-login-box input{width:100%;padding:14px;border:2px solid var(--border);border-radius:8px;font-size:1rem;font-family:inherit;margin-bottom:16px}
      .admin-login-box input:focus{outline:none;border-color:var(--danger)}
      .admin-login-box button{width:100%;padding:14px;background:var(--danger);color:white;border:none;border-radius:8px;font-weight:600;font-size:1rem;cursor:pointer;transition:all 0.2s;font-family:inherit}
      .admin-login-box button:hover{background:#b71c1c}
      .login-error{color:var(--danger);font-size:0.9rem;margin-bottom:16px;display:none}
      .login-error.show{display:block}

      .admin-users-list{max-height:400px;overflow-y:auto;border:1px solid var(--border);border-radius:8px;margin-top:12px}
      .admin-user-item{display:flex;justify-content:space-between;align-items:center;padding:12px;border-bottom:1px solid var(--border)}
      .admin-user-item:last-child{border-bottom:none}
      .admin-user-info{flex:1}
      .admin-user-info .name{font-weight:600;color:var(--text-primary)}
      .admin-user-info .role{font-size:0.8rem;color:var(--text-secondary);margin-top:4px}
      .role-badge{display:inline-block;padding:4px 12px;border-radius:12px;font-size:0.75rem;font-weight:600}
      .role-badge.dueno{background:rgba(211,47,47,0.2);color:#d32f2f}
      .role-badge.admin{background:rgba(255,87,34,0.2);color:#ff5722}
      .role-badge.mod{background:rgba(255,152,0,0.2);color:#ff9800}
      .role-badge.mod-junior{background:rgba(33,150,243,0.2);color:#2196f3}
      .admin-user-actions{display:flex;gap:6px}
      .admin-user-actions button{padding:6px 12px;font-size:0.75rem;border:none;border-radius:4px;cursor:pointer;transition:all 0.2s}
      .role-select{padding:6px;border:1px solid var(--border);border-radius:4px;font-size:0.75rem;cursor:pointer}
      .promote-btn{background:var(--primary);color:white}
      .promote-btn:hover{background:var(--primary-dark)}
      .demote-btn{background:#ff9800;color:white}
      .demote-btn:hover{background:#f57c00}
      .chart-container{background:white;padding:20px;border-radius:12px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,0.08)}
      .chart{width:100%;height:300px;position:relative}
      .bar-chart{display:flex;align-items:flex-end;justify-content:space-around;height:100%;gap:8px}
      .bar{flex:1;background:linear-gradient(180deg,var(--primary),var(--primary-dark));border-radius:8px 8px 0 0;min-height:20px;position:relative;transition:all 0.3s}
      .bar:hover{opacity:0.8;transform:translateY(-5px)}
      .bar-label{position:absolute;bottom:-25px;left:50%;transform:translateX(-50%);font-size:0.75rem;color:var(--text-secondary)}
      .bar-value{position:absolute;top:-25px;left:50%;transform:translateX(-50%);font-weight:600;color:var(--text-primary)}
      .live-feed{max-height:400px;overflow-y:auto;border:1px solid var(--border);border-radius:8px;background:var(--bg-light)}
      .live-message{padding:12px;border-bottom:1px solid var(--border);animation:slideIn 0.3s ease}
      .live-message:last-child{border-bottom:none}
      @keyframes slideIn{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:translateX(0)}}
      .word-list{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
      .word-badge{background:var(--danger);color:white;padding:6px 12px;border-radius:12px;font-size:0.85rem;display:flex;align-items:center;gap:6px}
      .word-badge button{background:rgba(255,255,255,0.3);border:none;color:white;border-radius:50%;width:20px;height:20px;cursor:pointer;font-size:0.7rem}
      .word-badge button:hover{background:rgba(255,255,255,0.5)}

      #customConfirmModal{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;backdrop-filter:blur(8px);z-index:9999;animation:fadeInModal 0.25s ease}
      #customConfirmModal.active{display:flex}
      @keyframes fadeInModal{from{opacity:0}to{opacity:1}}
      .confirm-dialog{background:white;padding:0;border-radius:16px;min-width:380px;max-width:450px;box-shadow:0 25px 80px rgba(0,0,0,0.35);overflow:hidden;animation:scaleIn 0.3s cubic-bezier(0.34,1.56,0.64,1)}
      @keyframes scaleIn{from{transform:scale(0.8);opacity:0}to{transform:scale(1);opacity:1}}
      .confirm-header{padding:24px 24px 16px;display:flex;align-items:center;gap:16px}
      .confirm-icon{width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.8rem;flex-shrink:0}
      .confirm-icon.warning{background:linear-gradient(135deg,#fff3cd,#ffeeba);color:#856404}
      .confirm-icon.danger{background:linear-gradient(135deg,#f8d7da,#f5c6cb);color:#721c24}
      .confirm-icon.info{background:linear-gradient(135deg,#d1ecf1,#bee5eb);color:#0c5460}
      .confirm-icon.success{background:linear-gradient(135deg,#d4edda,#c3e6cb);color:#155724}
      .confirm-content{flex:1}
      .confirm-content h3{margin:0 0 4px;font-size:1.15rem;color:var(--text-primary)}
      .confirm-content p{margin:0;color:var(--text-secondary);font-size:0.9rem;line-height:1.4}
      .confirm-body{padding:0 24px 20px;color:var(--text-secondary);font-size:0.9rem;line-height:1.5}
      .confirm-actions{display:flex;gap:12px;padding:16px 24px;background:var(--bg-light);justify-content:flex-end}
      .confirm-actions button{padding:12px 24px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-family:inherit;font-size:0.95rem;transition:all 0.2s}
      .confirm-actions .btn-cancel{background:white;color:var(--text-primary);border:1px solid var(--border)}
      .confirm-actions .btn-cancel:hover{background:#f5f5f5;border-color:#ccc}
      .confirm-actions .btn-confirm{background:var(--primary);color:white}
      .confirm-actions .btn-confirm:hover{background:var(--primary-dark);transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,180,216,0.3)}
      .confirm-actions .btn-confirm.danger{background:var(--danger)}
      .confirm-actions .btn-confirm.danger:hover{background:#b71c1c;box-shadow:0 4px 12px rgba(211,47,47,0.3)}
      .confirm-actions .btn-confirm.warning{background:var(--warning)}
      .confirm-actions .btn-confirm.warning:hover{background:#ff8c00;box-shadow:0 4px 12px rgba(255,165,0,0.3)}
      .confirm-actions .btn-confirm.success{background:var(--success)}
      .confirm-actions .btn-confirm.success:hover{background:#00b371;box-shadow:0 4px 12px rgba(0,208,132,0.3)}
      .confirm-actions .btn-confirm.info{background:var(--primary)}
      .confirm-actions .btn-confirm.info:hover{background:var(--primary-dark);box-shadow:0 4px 12px rgba(0,180,216,0.3)}
    </style>
  </head>

  <body>
    <div id="adminLoginOverlay">
      <div class="admin-login-box">
        <h1>üîê</h1>
        <p>Acceso al Panel de Administraci√≥n</p>
        <div id="connectionStatus" style="font-size:0.85rem;margin-bottom:12px;font-weight:500">üü° Conectando al servidor...</div>
        <div class="login-error" id="loginError">Credenciales incorrectas</div>
        <input id="adminLoginUsername" type="text" placeholder="Nombre de usuario admin" autofocus style="margin-bottom:12px" />
        <button id="adminLoginBtn">Acceder</button>
      </div>
    </div>

    <div class="admin-header">
      <div>
        <h1>üîë Panel Administrador</h1>
        <p>Control total del chat global <span id="headerConnectionStatus" style="font-size:0.8rem;margin-left:8px">üü°</span></p>
      </div>
      <a href="https://chatgeneral-ul1z.onrender.com" class="admin-back-btn" target="_blank">‚Üê Ir al Chat</a>
    </div>

    <aside class="sidebar">
      <ul class="sidebar-menu">
        <li class="sidebar-item">
          <a onclick="showSection('stats')" class="sidebar-link active">
            <span class="sidebar-icon">üìä</span>
            <span class="sidebar-text">Estad√≠sticas</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a onclick="showSection('users')" class="sidebar-link">
            <span class="sidebar-icon">üë•</span>
            <span class="sidebar-text">Usuarios</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a onclick="showSection('chat')" class="sidebar-link">
            <span class="sidebar-icon">üí¨</span>
            <span class="sidebar-text">Chat</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a onclick="showSection('rules')" class="sidebar-link">
            <span class="sidebar-icon">üìú</span>
            <span class="sidebar-text">Reglas</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a onclick="showSection('filter')" class="sidebar-link">
            <span class="sidebar-icon">üö´</span>
            <span class="sidebar-text">Filtro</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a onclick="showSection('ban')" class="sidebar-link">
            <span class="sidebar-icon">‚õî</span>
            <span class="sidebar-text">Ban</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a onclick="showSection('rooms')" class="sidebar-link">
            <span class="sidebar-icon">üè†</span>
            <span class="sidebar-text">Salas</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a onclick="showSection('live')" class="sidebar-link">
            <span class="sidebar-icon">üî¥</span>
            <span class="sidebar-text">Monitoreo</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a onclick="showSection('admins')" class="sidebar-link">
            <span class="sidebar-icon">üëë</span>
            <span class="sidebar-text">Admins</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a onclick="showSection('analytics')" class="sidebar-link">
            <span class="sidebar-icon">üìà</span>
            <span class="sidebar-text">An√°lisis</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a onclick="showSection('database')" class="sidebar-link">
            <span class="sidebar-icon">üíæ</span>
            <span class="sidebar-text">Base de Datos</span>
          </a>
        </li>
      </ul>
    </aside>

    <div class="admin-container">
      <div class="admin-section active" id="section-stats">
        <h2>üìä Estad√≠sticas</h2>
        <div class="stats">
          <div class="stat-card">
            <div class="value" id="totalUsers">0</div>
            <div class="label">Usuarios Conectados</div>
          </div>
          <div class="stat-card">
            <div class="value" id="totalBanned">0</div>
            <div class="label">IPs Baneadas</div>
          </div>
          <div class="stat-card">
            <div class="value" id="totalRooms">1</div>
            <div class="label">Salas Activas</div>
          </div>
        </div>
      </div>

      <div class="admin-section" id="section-admins">
        <h2>üëë Administradores</h2>
        <div style="background:var(--bg-light);padding:20px;border-radius:8px;margin-bottom:24px">
          <h3 style="margin:0 0 16px;color:var(--text-primary)">A√±adir Nuevo Administrador</h3>
          <div style="display:grid;gap:12px">
            <input id="addAdminUsername" type="text" placeholder="Nombre de usuario" style="width:100%;padding:12px;border:1px solid var(--border);border-radius:6px;font-family:inherit">
            <input id="addAdminPassword" type="password" placeholder="Contrase√±a (m√≠nimo 6 caracteres)" style="width:100%;padding:12px;border:1px solid var(--border);border-radius:6px;font-family:inherit">
            <select id="addAdminRole" style="width:100%;padding:12px;border:1px solid var(--border);border-radius:6px;font-family:inherit">
              <option value="Mod Junior">Mod Junior</option>
              <option value="Mod">Mod</option>
              <option value="Admin">Admin</option>
              <option value="Due√±o">Due√±o</option>
            </select>
            <button onclick="addAdminByName()" style="width:100%;padding:14px;background:var(--success);color:white;border:none;border-radius:6px;font-weight:600;cursor:pointer;font-family:inherit">‚ûï A√±adir Administrador</button>
          </div>
        </div>
        <div class="admin-controls" style="margin-bottom:16px">
          <button onclick="loadAdminUsers()" style="flex:1;padding:12px">üìã Ver Administradores</button>
          <button onclick="loadAdminUsers()" style="flex:0;padding:12px">üîÑ</button>
        </div>
        <div id="adminUsersList"></div>
      </div>

      <div class="admin-section" id="section-users">
        <h2>üë• Usuarios Conectados</h2>
        <div class="admin-controls" style="margin-bottom:16px">
          <input id="searchUser" type="text" placeholder="Buscar usuario...">
          <button onclick="refreshUsers()">üîÑ Actualizar</button>
        </div>
        <div id="usersContainer" style="max-height:600px;overflow-y:auto">
          <div class="empty-state">
            <p>Cargando usuarios...</p>
          </div>
        </div>
      </div>

      <div class="admin-section" id="section-chat">
        <h2>üí¨ Estado del Chat</h2>
        <div id="chatStatusDisplay" style="padding:16px;background:var(--bg-light);border-radius:8px;font-weight:600;color:var(--text-primary);margin-bottom:16px;font-size:1.1rem">
          Estado: Conectando...
        </div>
        <div style="display:grid;gap:12px">
          <button id="startChatBtn" style="width:100%;padding:14px;font-size:1rem">‚ñ∂ Iniciar Chat</button>
          <button id="stopChatBtn" style="width:100%;padding:14px;font-size:1rem" class="danger">‚èπ Parar Chat</button>
        </div>
      </div>

      <div class="admin-section" id="section-rules">
        <h2>üìú Reglas del Chat</h2>
        <div style="margin-top:4px;padding:16px;background:var(--bg-light);border-radius:8px">
          <p style="margin:0 0 12px;color:var(--text-secondary);font-size:0.95rem">Edita el texto que ver√°n todos en la sala #reglas.</p>
          <textarea id="rulesTextInput" style="width:100%;min-height:160px;padding:10px;border:1px solid var(--border);border-radius:8px;font-family:inherit;margin-bottom:10px"></textarea>
          <div style="display:flex;gap:10px;justify-content:flex-end">
            <button id="refreshRulesBtn" style="padding:10px 14px;background:var(--border);border:none;border-radius:8px;cursor:pointer;font-weight:600;color:var(--text-primary)">üîÑ Actualizar</button>
            <button id="saveRulesBtn" style="padding:10px 14px;background:var(--primary);color:white;border:none;border-radius:8px;cursor:pointer;font-weight:600">üíæ Guardar Reglas</button>
          </div>
        </div>
      </div>

      <div class="admin-section" id="section-ban">
        <h2>üö´ Ban / Kick</h2>
        <h3 style="margin:0 0 12px;color:var(--text-primary)">Gesti√≥n de IPs Baneadas</h3>
        <div class="admin-controls" style="margin-bottom:16px">
          <input id="banIpInput" type="text" placeholder="IP a banear..." style="flex:1">
          <button id="banIpBtn" class="danger">üö´ Banear IP</button>
        </div>
        <div id="bannedIpsList" style="max-height:400px;overflow-y:auto"></div>
      </div>

      <div class="admin-section" id="section-rooms">
        <h2>üè† Gesti√≥n de Salas</h2>
        <p style="color:var(--text-secondary);margin-bottom:16px">Administra las salas de chat.</p>
        <div class="admin-controls" style="margin-bottom:16px">
          <button onclick="loadRoomsList()" style="flex:1;padding:12px">üîÑ Actualizar Lista</button>
        </div>
        <div id="roomsListContainer" style="display:grid;gap:12px">
          <div style="text-align:center;padding:20px;color:var(--text-secondary)">Haz clic en "Actualizar Lista" para ver las salas</div>
        </div>
      </div>

      <div class="admin-section" id="section-filter">
        <h2>üö´ Filtro de Palabras</h2>
        <div style="background:white;padding:20px;border-radius:8px">
          <p style="margin-bottom:12px;color:var(--text-secondary)">Administra las palabras prohibidas en el chat:</p>
          <div style="display:flex;gap:12px;margin-bottom:16px">
            <input type="text" id="newBadWord" placeholder="Agregar palabra prohibida" style="flex:1;padding:10px;border:1px solid var(--border);border-radius:6px;font-family:inherit">
            <button onclick="addBadWord()" style="padding:10px 20px;background:var(--danger);color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600">‚ûï Agregar</button>
            <button onclick="loadBadWords()" style="padding:10px 20px;background:var(--primary);color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600">üîÑ Actualizar</button>
          </div>
          <div id="badWordsList" class="word-list"></div>
        </div>
      </div>

      <div class="admin-section" id="section-live">
        <h2>üî¥ Monitoreo en Vivo</h2>
        <div style="background:white;padding:20px;border-radius:8px">
          <div style="display:flex;gap:12px;margin-bottom:16px">
            <button id="startMonitorBtn" onclick="startLiveMonitor()" style="flex:1;padding:12px;background:var(--success);color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600">‚ñ∂Ô∏è Iniciar Monitoreo</button>
            <button id="stopMonitorBtn" onclick="stopLiveMonitor()" style="flex:1;padding:12px;background:var(--danger);color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600;display:none">‚èπÔ∏è Detener</button>
          </div>
          <div id="liveMessageFeed" class="live-feed" style="display:none"></div>
        </div>
      </div>

      <div class="admin-section" id="section-analytics">
        <h2>üìà An√°lisis y Gr√°ficos</h2>
        <button onclick="loadAnalytics()" style="padding:12px 24px;background:var(--primary);color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600;margin-bottom:20px">üîÑ Actualizar Gr√°ficos</button>
        
        <div class="chart-container">
          <h3 style="margin:0 0 16px;color:var(--text-primary)">Usuarios por Sala</h3>
          <div class="chart">
            <div class="bar-chart" id="roomChart"></div>
          </div>
        </div>
        
        <div class="chart-container">
          <h3 style="margin:0 0 16px;color:var(--text-primary)">Actividad Reciente</h3>
          <div class="chart">
            <div class="bar-chart" id="activityChart"></div>
          </div>
        </div>
        
        <div class="stats" style="grid-template-columns:repeat(4,1fr);margin-top:20px">
          <div class="stat-card">
            <div class="value" id="totalMessagesCount">0</div>
            <div class="label">Mensajes Totales</div>
          </div>
          <div class="stat-card">
            <div class="value" id="avgMessagesPerUser">0</div>
            <div class="label">Promedio por Usuario</div>
          </div>
          <div class="stat-card">
            <div class="value" id="mostActiveRoom">-</div>
            <div class="label">Sala M√°s Activa</div>
          </div>
          <div class="stat-card">
            <div class="value" id="totalReports">0</div>
            <div class="label">Reportes Recibidos</div>
          </div>
        </div>
      </div>

      <div class="admin-section" id="section-database">
        <h2>üíæ Base de Datos Personal</h2>
        <div style="background:var(--bg-light);padding:20px;border-radius:8px;margin-bottom:20px">
          <h3 style="margin:0 0 16px;color:var(--text-primary)">Agregar Nuevo Registro</h3>
          <div style="display:grid;gap:12px;grid-template-columns:1fr 1fr">
            <input id="dbKey" type="text" placeholder="Clave/T√≠tulo" style="padding:10px;border:1px solid var(--border);border-radius:6px;font-family:inherit">
            <input id="dbValue" type="text" placeholder="Valor/Descripci√≥n" style="padding:10px;border:1px solid var(--border);border-radius:6px;font-family:inherit">
            <select id="dbCategory" style="padding:10px;border:1px solid var(--border);border-radius:6px;font-family:inherit">
              <option value="general">General</option>
              <option value="notas">Notas</option>
              <option value="config">Configuraci√≥n</option>
              <option value="usuarios">Usuarios</option>
              <option value="otros">Otros</option>
            </select>
            <button onclick="addDatabaseRecord()" style="padding:10px;background:var(--success);color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600">‚ûï Agregar</button>
          </div>
        </div>

        <div class="admin-controls" style="margin-bottom:16px">
          <button onclick="loadDatabaseRecords()" style="flex:1;padding:10px;background:var(--primary);color:white;border:none;border-radius:6px;cursor:pointer">üîÑ Actualizar</button>
        </div>

        <div style="background:white;border-radius:8px;overflow:hidden;border:1px solid var(--border)">
          <table class="users-table" id="databaseTable">
            <thead style="position:sticky;top:0;background:white;z-index:10">
              <tr>
                <th>Clave</th>
                <th>Valor</th>
                <th>Categor√≠a</th>
                <th>Fecha</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="databaseTableBody">
              <tr>
                <td colspan="5" style="text-align:center;padding:20px;color:var(--text-secondary)">Cargando...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div id="changeNameModal" class="modal-overlay">
      <div class="modal-dialog">
        <h3>Cambiar nombre de usuario</h3>
        <input id="newNameInput" type="text" placeholder="Nuevo nombre" maxlength="30">
        <div class="modal-buttons">
          <button class="cancel" onclick="closeModal()">Cancelar</button>
          <button class="confirm" onclick="confirmChangeName()">Cambiar</button>
        </div>
      </div>
    </div>

    <div id="promoteModal" class="modal-overlay">
      <div class="modal-dialog">
        <h3>Promover Usuario a Admin</h3>
        <p style="font-size:0.9rem;color:var(--text-secondary);margin-bottom:16px">Usuario: <strong id="promoteUsername"></strong></p>
        <label style="display:block;margin-bottom:8px;font-weight:600">Selecciona Rol:</label>
        <select id="promoteRoleSelect" style="width:100%;padding:10px;border:1px solid var(--border);border-radius:6px;margin-bottom:16px;font-family:inherit">
          <option value="Mod Junior">Mod Junior</option>
          <option value="Mod">Mod</option>
          <option value="Admin">Admin</option>
          <option value="Due√±o">Due√±o</option>
        </select>
        <div class="modal-buttons">
          <button class="cancel" onclick="closePromoteModal()">Cancelar</button>
          <button class="confirm" onclick="confirmPromote()">Promover</button>
        </div>
      </div>
    </div>

    <div id="changeAdminPasswordModal" class="modal-overlay">
      <div class="modal-dialog">
        <h3>Cambiar Contrase√±a - <span id="adminPasswordModalUsername"></span></h3>
        <input id="adminNewPassword" type="password" placeholder="Nueva contrase√±a (m√≠n. 6 caracteres)" style="width:100%;padding:10px;border:1px solid var(--border);border-radius:6px;margin-bottom:16px;font-family:inherit">
        <div class="modal-buttons">
          <button class="cancel" onclick="closeAdminPasswordModal()">Cancelar</button>
          <button class="confirm" onclick="confirmChangeAdminPassword()">Cambiar Contrase√±a</button>
        </div>
      </div>
    </div>

    <div id="toast" class="toast">
      <span id="toastMessage"></span>
    </div>

    <div id="customConfirmModal">
      <div class="confirm-dialog">
        <div class="confirm-header">
          <div class="confirm-icon warning" id="confirmIcon">‚ö†Ô∏è</div>
          <div class="confirm-content">
            <h3 id="confirmTitle">Confirmar acci√≥n</h3>
            <p id="confirmSubtitle"></p>
          </div>
        </div>
        <div class="confirm-body" id="confirmBody"></div>
        <div class="confirm-actions">
          <button class="btn-cancel" id="confirmCancelBtn">Cancelar</button>
          <button class="btn-confirm" id="confirmOkBtn">Aceptar</button>
        </div>
      </div>
    </div>

    <script>
      // Conexi√≥n al servidor de chatgeneral en Render
      const socket = io('https://chatgeneral-ul1z.onrender.com', {
        transports: ['websocket', 'polling'],
        withCredentials: false,
        reconnection: true,
        reconnectionAttempts: 10,
        reconnectionDelay: 1000,
        reconnectionDelayMax: 5000,
        timeout: 20000
      });

      // Estado de conexi√≥n global
      let connectionStatus = 'connecting';

      socket.on('connect', () => {
        console.log('‚úÖ Conectado al servidor de chat');
        connectionStatus = 'connected';
        updateConnectionUI();
      });

      socket.on('disconnect', (reason) => {
        console.log('‚ùå Desconectado del servidor:', reason);
        connectionStatus = 'disconnected';
        updateConnectionUI();
      });

      socket.on('connect_error', (error) => {
        console.log('‚ö†Ô∏è Error de conexi√≥n:', error.message);
        connectionStatus = 'error';
        updateConnectionUI();
      });

      socket.on('reconnecting', (attemptNumber) => {
        console.log('üîÑ Reconectando... intento', attemptNumber);
        connectionStatus = 'reconnecting';
        updateConnectionUI();
      });

      socket.on('reconnect', () => {
        console.log('‚úÖ Reconexi√≥n exitosa');
        connectionStatus = 'connected';
        updateConnectionUI();
      });

      function updateConnectionUI() {
        const statusIndicator = document.getElementById('connectionStatus');
        const headerStatus = document.getElementById('headerConnectionStatus');
        const loginError = document.getElementById('loginError');
        
        if (statusIndicator) {
          switch(connectionStatus) {
            case 'connected':
              statusIndicator.innerHTML = 'üü¢ Conectado al servidor';
              statusIndicator.style.color = '#00d084';
              break;
            case 'disconnected':
              statusIndicator.innerHTML = 'üî¥ Desconectado';
              statusIndicator.style.color = '#d32f2f';
              break;
            case 'connecting':
              statusIndicator.innerHTML = 'üü° Conectando...';
              statusIndicator.style.color = '#ffa500';
              break;
            case 'reconnecting':
              statusIndicator.innerHTML = 'üü° Reconectando...';
              statusIndicator.style.color = '#ffa500';
              break;
            case 'error':
              statusIndicator.innerHTML = 'üî¥ Error de conexi√≥n';
              statusIndicator.style.color = '#d32f2f';
              break;
          }
        }

        // Actualizar indicador del header
        if (headerStatus) {
          switch(connectionStatus) {
            case 'connected':
              headerStatus.innerHTML = 'üü¢';
              headerStatus.title = 'Conectado al servidor';
              break;
            case 'disconnected':
              headerStatus.innerHTML = 'üî¥';
              headerStatus.title = 'Desconectado del servidor';
              break;
            case 'connecting':
            case 'reconnecting':
              headerStatus.innerHTML = 'üü°';
              headerStatus.title = 'Conectando...';
              break;
            case 'error':
              headerStatus.innerHTML = 'üî¥';
              headerStatus.title = 'Error de conexi√≥n';
              break;
          }
        }

        // Tambi√©n actualizar el mensaje de login si existe
        if (loginError && connectionStatus === 'connected') {
          loginError.classList.remove('show');
        }
      }
    </script>
    <script src="admin.js"></script>
  </body>
</html>